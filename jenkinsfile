pipeline {
agent any


stages {
stage('Checkout Code') {
steps {
git branch: 'main', url: 'https://github.com/your-repo/devsecops-python-lab.git'
}
}


stage('Install Dependencies') {
steps {
sh 'pip3 install -r requirements.txt'
}
}


stage('SAST - Bandit') {
steps {
sh 'bandit -r . -f html -o bandit-report.html'
}
}


stage('Dependency Check - Safety') {
steps {
sh 'safety check -r requirements.txt --json > safety-report.json'
}
}


stage('DAST - OWASP ZAP') {
steps {
sh '''
docker run --rm -v $(pwd):/zap/wrk \
owasp/zap2docker-stable zap-baseline.py \
-t http://example.com \
-r zap-report.html
'''
}
}


stage('Publish Reports') {
steps {
publishHTML(target: [
allowMissing: true,
alwaysLinkToLastBuild: true,
keepAll: true,
reportDir: '.',
reportFiles: 'bandit-report.html,zap-report.html',
reportName: 'Security Reports'
])
}
}
}
}